# ğŸ‰ HackScore AI ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†

## âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### ã€backend_1ã€‘âœ… Supabase Queues + Edge Worker
- pgmq ãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
- Edge Functions ã§ã®ã‚¸ãƒ§ãƒ–æŠ•å…¥ (`enqueue`)
- Edge Worker ã§ã®ã‚­ãƒ¥ãƒ¼å‡¦ç† (`repo_worker`)
- ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

### ã€backend_2ã€‘âœ… Vaultï¼ˆæ©Ÿå¯†æƒ…å ±ç®¡ç†ï¼‰
- pgcrypto ãƒ™ãƒ¼ã‚¹ã®æš—å·åŒ–ã‚·ã‚¹ãƒ†ãƒ 
- Anthropic API ã‚­ãƒ¼ãƒ»GitHub ãƒˆãƒ¼ã‚¯ãƒ³ã®å®‰å…¨ãªä¿å­˜
- Edge Functions ã‹ã‚‰ã®æ©Ÿå¯†æƒ…å ±å–å¾—

### ã€backend_3ã€‘âœ… ClaudeCode å®Ÿè¡Œ
- Cloud Run Worker ã§ã® @anthropic-ai/claude-code å®Ÿè¡Œ
- GitHub MCP ã‚’ä½¿ç”¨ã—ãŸãƒªãƒã‚¸ãƒˆãƒªè§£æ
- ãƒãƒƒã‚«ã‚½ãƒ³è©•ä¾¡åŸºæº–ã«ã‚ˆã‚‹æ¡ç‚¹

### ã€backend_4ã€‘âœ… çµæœãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
- è©•ä¾¡çµæœã®è‡ªå‹•æ¤œçŸ¥ãƒ»æ§‹é€ åŒ–ä¿å­˜
- evaluation_results / evaluation_items ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†
- SQLã‚¯ã‚¨ãƒªé–¢æ•°ã«ã‚ˆã‚‹çµæœå–å¾—

## ğŸ—ï¸ æœ€çµ‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Functions  â”‚    â”‚ Supabase         â”‚    â”‚ Cloud Run       â”‚
â”‚ (enqueue)       â”‚â”€â”€â”€â–¶â”‚ pgmq Queue       â”‚â”€â”€â”€â–¶â”‚ ClaudeCode      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚    â”‚ Worker          â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                                â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Supabase         â”‚â—€â”€â”€â”€â”‚ Results         â”‚
                       â”‚ Database + Vault â”‚    â”‚ Storage         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆæœ¬ç•ªå¯¾å¿œï¼‰

```
backend/
â”œâ”€â”€ cloud-run-worker/                 # Cloud Run Worker
â”‚   â”œâ”€â”€ src/index.js                 # ãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼ˆClaudeCodeå®Ÿè¡Œï¼‰
â”‚   â”œâ”€â”€ package.json                 # ä¾å­˜é–¢ä¿‚
â”‚   â”œâ”€â”€ Dockerfile                   # ã‚³ãƒ³ãƒ†ãƒŠè¨­å®š
â”‚   â”œâ”€â”€ .env                         # ç’°å¢ƒå¤‰æ•°
â”‚   â”œâ”€â”€ .env.example                 # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ deploy.yaml                  # Cloud Runè¨­å®š
â”‚   â”œâ”€â”€ scripts/                     # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ README.md                    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml                  # Supabaseè¨­å®š
â”‚   â”œâ”€â”€ .env                         # Edge Functionsç’°å¢ƒå¤‰æ•°
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ enqueue/index.ts         # ã‚¸ãƒ§ãƒ–æŠ•å…¥
â”‚   â”‚   â”œâ”€â”€ repo_worker/index.ts     # Cloud Runè»¢é€
â”‚   â”‚   â””â”€â”€ vault_test/index.ts      # Vaultå‹•ä½œç¢ºèª
â”‚   â””â”€â”€ migrations/                  # æœ¬ç•ªç”¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â”œâ”€â”€ 20250622001_enable_pgmq.sql        # pgmqåŸºæœ¬æ©Ÿèƒ½
â”‚       â”œâ”€â”€ 20250622002_pgmq_functions.sql     # pgmq RPCé–¢æ•°
â”‚       â”œâ”€â”€ 20250622005_vault_setup.sql        # Vaultæ©Ÿèƒ½
â”‚       â””â”€â”€ 20250622006_evaluation_results.sql # è©•ä¾¡çµæœãƒ†ãƒ¼ãƒ–ãƒ«
â”œâ”€â”€ .env.example                     # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ BACKEND_COMPLETION.md            # å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ
â””â”€â”€ README.md                        # ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## ğŸš€ å‹•ä½œç¢ºèªæ¸ˆã¿

1. **ã‚¸ãƒ§ãƒ–æŠ•å…¥**: Edge Functions â†’ pgmq ã‚­ãƒ¥ãƒ¼ âœ…
2. **ã‚­ãƒ¥ãƒ¼å‡¦ç†**: Edge Functions â†’ Cloud Run è»¢é€ âœ…
3. **ClaudeCodeå®Ÿè¡Œ**: GitHubè§£æ + è©•ä¾¡ âœ…
4. **çµæœä¿å­˜**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ§‹é€ åŒ–ä¿å­˜ âœ…

## ğŸ”§ ç’°å¢ƒå¤‰æ•°è¨­å®š

### Edge Functions (.env)
```bash
CLOUD_RUN_WORKER_URL=http://host.docker.internal:8080
CLOUD_RUN_AUTH_TOKEN=F24B2438-E1DC-477A-ADE2-BA97E19B64B1
```

### Cloud Run Worker (.env)
```bash
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
CLOUD_RUN_AUTH_TOKEN=F24B2438-E1DC-477A-ADE2-BA97E19B64B1
PORT=8080
MAX_TURNS_PER_ANALYSIS=50
ANALYSIS_TIMEOUT_MS=300000
```

## ğŸ¯ å®Œæˆã—ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```bash
# 1. ã‚¸ãƒ§ãƒ–æŠ•å…¥
curl -X POST http://localhost:54321/functions/v1/enqueue \
  -H "Authorization: Bearer [ANON_KEY]" \
  -d '{"repositories":["user/repo"], "userId":"user-id"}'

# 2. å‡¦ç†å®Ÿè¡Œ
curl -X POST http://localhost:54321/functions/v1/repo_worker \
  -H "Authorization: Bearer [ANON_KEY]"

# çµæœ: 
# - ClaudeCode ã§ãƒªãƒã‚¸ãƒˆãƒªè§£æ
# - ãƒãƒƒã‚«ã‚½ãƒ³è©•ä¾¡ã‚¹ã‚³ã‚¢ç®—å‡º
# - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ§‹é€ åŒ–ä¿å­˜
```

## ğŸ† å®Ÿè£…æˆæœ

- âœ… å…¨ã¦ã®è¦ä»¶ï¼ˆbackend_1ã€œ4ï¼‰å®Œå…¨å®Ÿè£…
- âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªæ©Ÿå¯†æƒ…å ±ç®¡ç†
- âœ… å®Œå…¨ãªå‹•ä½œç¢ºèªæ¸ˆã¿
- âœ… æœ¬ç•ªç’°å¢ƒå¯¾å¿œè¨­è¨ˆ

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†ï¼ğŸ‰